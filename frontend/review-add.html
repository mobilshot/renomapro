<!doctype html>
<html><head><meta charset="utf-8"><title>Dodaj opinię</title>
<style>
body{font-family:Arial;padding:20px;background:#f5f5f5;}
.card{background:white;padding:20px;border-radius:10px;}
.star{font-size:32px;color:#ccc;cursor:pointer;}
.star.selected{color:#f0b800;}
</style>
</head>
<body>
<h2>Dodaj opinię o fachowcu</h2>
<div class="card">
    <label>Ocena:</label><br>
    <span class="star" data-v="1">★</span>
    <span class="star" data-v="2">★</span>
    <span class="star" data-v="3">★</span>
    <span class="star" data-v="4">★</span>
    <span class="star" data-v="5">★</span>
    <br><br>
    <textarea id="comment" placeholder="Komentarz" style="width:100%;height:100px;"></textarea>
    <br><br>
    <button onclick="submitReview()">Wyślij opinię</button>
</div>

<script>
const API = (location.hostname==='localhost')?'http://localhost:3000':location.origin;

let fachowiec_id = new URLSearchParams(window.location.search).get("id");
let stars = document.querySelectorAll('.star');
let rating = 0;

stars.forEach(s=>s.addEventListener('click', ()=>{
  stars.forEach(x=>x.classList.remove('selected'));
  s.classList.add('selected');
  rating = s.dataset.v;
}));

async function submitReview(){
    const token = localStorage.getItem('client_token');
    if(!token){ alert('Zaloguj się jako klient'); return; }
    const body = {fachowiec_id, rating, comment:document.getElementById('comment').value};
    const r = await fetch(API+'/api/opinions',{
        method:'POST',
        headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},
        body:JSON.stringify(body)
    });
    if(r.ok){ alert('Opinia zapisana'); history.back(); }
    else alert('Błąd');
}
</script>
</body></html>
