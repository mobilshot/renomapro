<!doctype html>
<html lang="pl"><head><meta charset="utf-8"><title>Panel właściciela – RenomaPro</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f8fb;color:#111;margin:0;padding:18px}
.header{display:flex;align-items:center;justify-content:space-between;background:#0f172a;color:#fff;padding:12px;border-radius:8px}
.container{max-width:1100px;margin:18px auto}
.card{background:#fff;padding:14px;border-radius:8px;margin-top:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
.kpi{display:flex;gap:12px;flex-wrap:wrap}
.kpi .item{background:#fff;padding:12px;border-radius:8px;min-width:160px;text-align:center;box-shadow:0 4px 12px rgba(15,23,42,0.04)}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
.btn{background:#b8860b;color:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
</style></head><body>
<div class="header"><div><strong>RenomaPro — Panel właściciela</strong></div><div><button class="btn" id="btnLogout">Wyloguj</button></div></div>
<div class="container">
  <div class="card">
    <h3>Kluczowe wskaźniki</h3>
    <div class="kpi" id="kpi"></div>
  </div>
  <div class="card">
    <h3>Ostatnie zgłoszenia</h3>
    <table class="table" id="leadsTable"><thead><tr><th>ID</th><th>Imię</th><th>Telefon</th><th>Opis</th><th>Data</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="card">
    <h3>Lista subskrybentów (płatności)</h3>
    <table class="table" id="subsTable"><thead><tr><th>ID</th><th>Nazwa</th><th>Email</th><th>Stripe customer</th></tr></thead><tbody></tbody></table>
  </div>
</div>
<script>
const API = (location.hostname==='localhost') ? 'http://localhost:3000' : location.origin;
let token = localStorage.getItem('rp_admin_token') || localStorage.getItem('rp_token') || localStorage.getItem('client_token');
if(!token){ alert('Musisz się zalogować jako admin.'); location.href='/'; }
async function loadStats(){
  const r = await fetch(API + '/api/owner/stats', {headers:{'Authorization':'Bearer '+token}});
  if(!r.ok){ alert('Brak dostępu. Zaloguj się jako admin.'); return; }
  const j = await r.json();
  const kpi = document.getElementById('kpi');
  kpi.innerHTML = `<div class="item"><strong>${j.users}</strong><div>Użytkownicy</div></div>
  <div class="item"><strong>${j.fachowcy}</strong><div>Fachowcy</div></div>
  <div class="item"><strong>${j.leads}</strong><div>Leady</div></div>
  <div class="item"><strong>${j.subscribers}</strong><div>Subskrypcje</div></div>`;
}
async function loadLeads(){
  const r = await fetch(API + '/api/owner/leads', {headers:{'Authorization':'Bearer '+token}});
  const j = await r.json();
  const tbody = document.querySelector('#leadsTable tbody');
  tbody.innerHTML='';
  j.forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${l.id}</td><td>${l.name||''}</td><td>${l.phone||''}</td><td>${(l.desc||'').slice(0,80)}</td><td>${l.created_at||''}</td>`;
    tbody.appendChild(tr);
  });
}
async function loadSubs(){
  const r = await fetch(API + '/api/owner/payments', {headers:{'Authorization':'Bearer '+token}});
  const j = await r.json();
  const tbody = document.querySelector('#subsTable tbody');
  tbody.innerHTML='';
  j.forEach(s=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.id}</td><td>${s.name||''}</td><td>${s.email||''}</td><td>${s.stripe_customer_id||''}</td>`;
    tbody.appendChild(tr);
  });
}
document.getElementById('btnLogout').addEventListener('click', ()=>{ localStorage.removeItem('rp_admin_token'); localStorage.removeItem('rp_token'); localStorage.removeItem('client_token'); location.href='/'; });
loadStats(); loadLeads(); loadSubs();
</script>
</body></html>
